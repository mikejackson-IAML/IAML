<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta Tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Meet IAML's practicing attorneys and HR professionals who bring real-world expertise and current industry insights to every program.">
  <meta name="keywords" content="IAML, faculty, employment law attorneys, HR training, practicing attorneys, professional development">
  <meta name="author" content="Institute for Applied Management & Law">

  <!-- Open Graph / Social Media -->
  <meta property="og:title" content="Our Faculty - Meet the Practicing Attorneys Who Teach What Actually Works">
  <meta property="og:description" content="Learn from attorneys who win cases, not trainers who read about them. IAML faculty includes partners from top employment law firms and HR executives from Fortune 500 companies.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://iaml.com/faculty">
  <meta property="og:image" content="https://iaml.com/images/og-image.jpg">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

  <title>Our Faculty - IAML | Meet the Practicing Attorneys Who Teach What Actually Works</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Lato:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- CDN & External Service Preconnects -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://storage.googleapis.com">
  <link rel="preconnect" href="https://www.googletagmanager.com">

  <!-- Main CSS -->
  <link rel="stylesheet" href="../css/main.css">

  <!-- Google Analytics (Replace with your GA4 ID) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX');
  </script>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "IAML",
      "description": "Employment law and HR management education by practicing professionals",
      "faculty": {
          "@type": "Person",
          "@id": "faculty"
      }
  }
  </script>
</head>
<body class="faculty-page">

  <!-- ===== HEADER ===== -->
  <!-- Header placeholder (loaded by components.js) -->
  <div id="header-placeholder"></div>

  <!-- NoScript fallback for progressive enhancement -->
  <noscript>
    <nav style="position: fixed; top: 0; width: 100%; background: white; padding: 16px; text-align: center; z-index: 1000;">
      <a href="/">Home</a> |
      <a href="/featured-programs">Programs</a> |
      <a href="/pages/corporate-training">Corporate</a> |
      <a href="/about-us">Why IAML</a>
    </nav>
  </noscript>

  <!-- ===== MAIN CONTENT ===== -->
  <main>

    <!-- ===== HERO SECTION ===== -->
    <section class="faculty-hero-section">
      <div class="faculty-hero-content">
        <div class="faculty-trusted-text">
          LEARN FROM ATTORNEYS WHO WIN CASES, NOT TRAINERS WHO READ ABOUT THEM
        </div>

        <h1 class="faculty-main-headline">
          Meet the Practicing Attorneys Who<br>
          Teach What Actually Works
        </h1>

        <p class="faculty-hero-description">
          Other companies use corporate trainers with PowerPoint slides. We use practicing attorneys and experienced HR professionals who handle workplace law challenges daily. When they teach, they're sharing what actually worked in real situations, not theories from textbooks.
        </p>

        <div class="faculty-button-container group-buttons">
          <a href="https://iaml.com/program-schedule" class="glass-btn glass-btn-blue glass-btn-lg">Training Schedule</a>
          <a href="#" class="glass-btn glass-btn-red glass-btn-lg" onclick="connectPopup_open(); return false;">Reserve Your Spot</a>
        </div>
      </div>
    </section>

    <!-- ===== FACULTY CONTENT SECTION ===== -->
    <section class="faculty-content-section">
      <div class="faculty-page-container">

        <!-- Quick Navigation -->
        <nav class="practice-nav" role="navigation" aria-label="Practice areas">
          <div class="nav-container">
            <a href="#employment-law" class="nav-link active">Employment Law</a>
            <a href="#hr-management" class="nav-link">HR Management</a>
            <a href="#benefits-law" class="nav-link">Benefits Law</a>
            <a href="#safety-law" class="nav-link">Environmental Health & Safety</a>
          </div>
        </nav>

        <!-- Faculty Sections -->
        <div class="faculty-content">
          <!-- Employment Law Section -->
          <section id="employment-law" class="practice-section">
            <h2 class="practice-area-title">Employment Law</h2>
            <p class="practice-description">After decades representing employers in high-stakes cases, these attorneys know the difference between what the regulations say and what actually works in practice.</p>

            <div class="faculty-grid">
              <!-- Faculty cards will be populated dynamically from Airtable -->
            </div>
          </section>

          <!-- HR Management Section -->
          <section id="hr-management" class="practice-section">
            <h2 class="practice-area-title">HR Management</h2>
            <p class="practice-description">HR executives who've built departments from the ground up, managed through every crisis you can imagine, and learned what actually works in real workplaces.</p>

            <div class="faculty-grid">
              <!-- Faculty cards will be populated dynamically from Airtable -->
            </div>
          </section>

          <!-- Benefits Law Section -->
          <section id="benefits-law" class="practice-section">
            <h2 class="practice-area-title">Benefits Law</h2>
            <p class="practice-description">Benefits attorneys who've defended multi-million dollar benefit plan lawsuits and know exactly which compliance gaps create the biggest risks - and how to fix them.</p>

            <div class="faculty-grid">
              <!-- Faculty cards will be populated dynamically from Airtable -->
            </div>
          </section>

          <!-- Environmental Health & Safety Section -->
          <section id="safety-law" class="practice-section">
            <h2 class="practice-area-title">Environmental Health & Safety</h2>
            <p class="practice-description">Attorneys who've managed workplace incidents, defended OSHA citations, and learned what prevention strategies actually work in the real world.</p>

            <div class="faculty-grid">
              <!-- Faculty cards will be populated dynamically from Airtable -->
            </div>
          </section>
        </div>

      </div>
    </section>

    <!-- ===== FINAL CTA SECTION ===== -->
    <section id="iaml-cta" class="theme-light py-5xl">
      <div class="container container-lg mx-auto text-center">
        <div class="mx-auto">
          <h2 class="font-body text-display-lg text-primary font-light tracking-tight">
            Experience the
            <span class="cta-cascade font-display text-hero text-brand">Professional's Choice in Training</span>
          </h2>

          <p class="font-body text-large text-secondary my-lg">
            Real-world expertise. Guaranteed results. Trusted since 1979.
          </p>

          <div class="cta-button-group">
            <button class="btn btn-primary hover-lift" id="openContactModal" onclick="connectPopup_open()">
              LET'S TALK
            </button>
            <a href="https://iaml.com/featured-programs" class="btn btn-register hover-lift">
              REGISTER NOW
            </a>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- ===== FOOTER ===== -->
  <!-- Footer placeholder (loaded by components.js) -->
  <div id="footer-placeholder"></div>

  <!-- ===== MODALS ===== -->

  <!-- Connect Modal -->
  <div class="connectPopup-overlay" id="connectPopup_Modal" onclick="connectPopup_closeOnOverlay(event)">
    <div class="connectPopup-modal" onclick="event.stopPropagation();">
      <div class="connectPopup-header">
        <h3>Connect with Us in 20 Seconds or Less</h3>
        <button class="connectPopup-closeBtn" onclick="connectPopup_close()" aria-label="Close">&times;</button>
      </div>
      <div class="connectPopup-body" id="connectPopup_Content">
        <!-- Dynamic content -->
      </div>
    </div>
  </div>

  <!-- ===== JAVASCRIPT ===== -->

  <!-- Dynamic Component Loading -->
  <script src="../js/components.js" defer></script>
  <script src="../js/headerBehavior.js" defer></script>
  <script src="../js/mobileMenu.js" defer></script>

  <!-- Your JavaScript Files -->
  <script src="../js/modals.js" defer></script>
  <script src="../js/main.js" defer></script>

  <!-- Practice Area Navigation -->
  <script>
    // ============================================================================
    // PRACTICE AREA NAVIGATION
    // ============================================================================
    let navigationFixed = false;

    function forceFixNavigation() {
      if (navigationFixed) return;

      const navLinks = document.querySelectorAll('.practice-nav .nav-link');

      // Remove all existing event listeners by cloning elements
      navLinks.forEach((link, index) => {
        const newLink = link.cloneNode(true);
        link.parentNode.replaceChild(newLink, link);
      });

      // Get fresh references
      const freshNavLinks = document.querySelectorAll('.practice-nav .nav-link');

      // Apply our click handlers
      freshNavLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();

          // Force remove active from ALL links
          freshNavLinks.forEach(l => {
            l.classList.remove('active');
          });

          // Force add active to clicked link
          this.classList.add('active');

          // Handle scrolling
          const targetId = this.getAttribute('href').substring(1);
          const targetSection = document.getElementById(targetId);
          if (targetSection) {
            targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        });
      });

      // Set first link as active initially
      if (freshNavLinks.length > 0) {
        freshNavLinks[0].classList.add('active');
      }

      navigationFixed = true;
    }

    // Apply fix multiple times to ensure it overrides everything
    document.addEventListener('DOMContentLoaded', forceFixNavigation);
    window.addEventListener('load', forceFixNavigation);
    setTimeout(forceFixNavigation, 500);
    setTimeout(forceFixNavigation, 1000);
  </script>

  <!-- Faculty Page JavaScript: Airtable Integration -->
  <script>
    // ============================================================================
    // AIRTABLE CONFIGURATION
    // ============================================================================
    const AIRTABLE_CONFIG = {
      instructorsTableId: 'tblKAY2APl6AGqW7S',
      testimonialsTableId: 'tblsu840FYsWbNJRC'
    };

    // Cache configuration
    const CACHE_KEY = 'iaml_faculty_programs';
    const TESTIMONIALS_CACHE_KEY = 'iaml_faculty_testimonials';
    const CACHE_DURATION = 30 * 60 * 1000; // 30 minutes

    // ============================================================================
    // UTILITY FUNCTIONS
    // ============================================================================

    /**
     * Escape HTML to prevent XSS
     */
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    /**
     * Get instructor headshot URL from Airtable field
     */
    function getInstructorHeadshot(record) {
      // Check for the "Headshot URL" field (text field with direct URL)
      if (record.fields['Headshot URL'] && typeof record.fields['Headshot URL'] === 'string') {
        const url = record.fields['Headshot URL'].trim();
        if (url.startsWith('http://') || url.startsWith('https://')) {
          return url;
        }
      }

      // Fallback: Check for the "Headshot" field
      if (record.fields['Headshot'] && typeof record.fields['Headshot'] === 'string') {
        const url = record.fields['Headshot'].trim();
        if (url.startsWith('http://') || url.startsWith('https://')) {
          return url;
        }
      }

      // Fallback: Check for attachment field
      if (record.fields['Headshot'] && Array.isArray(record.fields['Headshot']) && record.fields['Headshot'].length > 0) {
        return record.fields['Headshot'][0]?.url;
      }

      return null;
    }

    /**
     * Format bio text to preserve paragraphs
     */
    function formatBioText(bioText) {
      if (!bioText) return '';

      const escapedText = escapeHtml(bioText);

      const paragraphs = escapedText
        .split(/\n\s*\n/)
        .map(p => p.trim())
        .filter(p => p.length > 0);

      if (paragraphs.length === 1) {
        const singleLineParagraphs = escapedText
          .split(/\n/)
          .map(p => p.trim())
          .filter(p => p.length > 0);

        if (singleLineParagraphs.length > 1) {
          return singleLineParagraphs
            .map(p => `<p>${p}</p>`)
            .join('');
        }
      }

      return paragraphs
        .map(paragraph => `<p>${paragraph}</p>`)
        .join('');
    }

    /**
     * Format bar admissions text
     */
    function formatBarAdmissions(barAdmissionsText) {
      if (!barAdmissionsText) return '';

      const escapedText = escapeHtml(barAdmissionsText.trim());

      if (escapedText.includes(',')) {
        return `<strong>Bar Admissions:</strong> ${escapedText}`;
      }

      const entries = escapedText
        .split(/\n/)
        .map(entry => entry.trim())
        .filter(entry => entry.length > 0);

      if (entries.length > 1) {
        return `<strong>Bar Admissions:</strong> ${entries.join(', ')}`;
      }

      return `<strong>Bar Admissions:</strong> ${escapedText}`;
    }

    /**
     * Format education text
     */
    function formatEducation(educationText) {
      if (!educationText) return '';

      const escapedText = escapeHtml(educationText.trim());

      const lines = escapedText
        .split(/\n/)
        .map(line => line.trim())
        .filter(line => line.length > 0);

      if (lines.length === 1) {
        return `<strong>Education:</strong> ${lines[0]}`;
      } else if (lines.length >= 2) {
        const firstDegree = lines[0];
        const additionalDegrees = lines.slice(1);

        const indentedDegrees = additionalDegrees
          .map(degree => `<div style="margin-top: 2px;">${degree}</div>`)
          .join('');

        return `<strong>Education:</strong> ${firstDegree}${indentedDegrees}`;
      }

      return `<strong>Education:</strong> ${escapedText}`;
    }

    // ============================================================================
    // FACULTY CARD CREATION
    // ============================================================================

    /**
     * Create a faculty card element
     */
    function createFacultyCard(instructor) {
      const cardDiv = document.createElement('div');
      cardDiv.className = 'faculty-card';
      cardDiv.setAttribute('data-faculty-id', instructor.facultyId);

      const imageUrl = instructor.headshot || '/images/placeholder-attorney.jpg';

      cardDiv.innerHTML = `
        <div class="faculty-image-container">
          <img src="${imageUrl}" alt="${escapeHtml(instructor.name)}" class="faculty-headshot" loading="lazy">
        </div>
        <div class="faculty-info">
          <h3 class="faculty-name">${escapeHtml(instructor.name)}</h3>
          <div class="faculty-credentials">${escapeHtml(instructor.title)}</div>
          <div class="faculty-bio">
            ${formatBioText(instructor.bio)}
          </div>

          <!-- Teaching Programs Section -->
          <div class="teaching-programs" style="display: none;">
            <div class="programs-list" id="programs-${instructor.facultyId}">
              <div class="loading-skeleton">Loading upcoming programs...</div>
            </div>
          </div>

          <!-- On-Demand Programs Section -->
          <div class="teaching-programs" style="display: none;">
            <div class="programs-list" id="on-demand-${instructor.facultyId}">
              <div class="loading-skeleton">Loading on-demand programs...</div>
            </div>
          </div>

          <!-- Testimonial Section -->
          <div class="testimonial-section" id="testimonials-${instructor.facultyId}" style="display: none;">
            <!-- Testimonials will be populated dynamically -->
          </div>

          <!-- Credentials Section -->
          <div class="credentials-section">
            ${instructor.barAdmissions ? `<div class="bar-admissions">${formatBarAdmissions(instructor.barAdmissions)}</div>` : ''}
            ${instructor.education ? `<div class="education">${formatEducation(instructor.education)}</div>` : ''}
          </div>
        </div>
      `;

      return cardDiv;
    }

    // ============================================================================
    // POPULATE FACULTY CARDS
    // ============================================================================

    /**
     * Populate faculty cards dynamically based on instructor data
     */
    function populateFacultyCards(instructorRecords) {
      const practiceAreaMap = {
        'Employment Law': 'employment-law',
        'HR Management': 'hr-management',
        'Benefits Law': 'benefits-law',
        'Environmental Health & Safety': 'safety-law'
      };

      // Clear existing faculty cards
      Object.values(practiceAreaMap).forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
          const facultyGrid = section.querySelector('.faculty-grid');
          if (facultyGrid) {
            facultyGrid.innerHTML = '';
          }
        }
      });

      // Group instructors by practice areas
      const instructorsByPractice = {};

      instructorRecords.forEach(record => {
        let instructorName = record.fields['Name'] || '';
        let instructorTitle = record.fields['Title'] || '';

        // If name is empty but title contains both, split them
        if (!instructorName && instructorTitle) {
          let separators = [' – ', ' - ', ' — ', ' | ', '  '];
          let foundSeparator = false;

          for (let separator of separators) {
            if (instructorTitle.includes(separator)) {
              const parts = instructorTitle.split(separator);
              instructorName = parts[0].trim();
              instructorTitle = parts[1].trim();
              foundSeparator = true;
              break;
            }
          }

          if (!foundSeparator && instructorTitle.length > 0) {
            instructorName = instructorTitle;
            instructorTitle = '';
          }
        }

        const instructor = {
          id: record.id,
          name: instructorName,
          title: instructorTitle,
          lastName: record.fields['Last Name'] || '',
          firstName: record.fields['First Name'] || '',
          practiceAreas: Array.isArray(record.fields['Practice Areas'])
            ? record.fields['Practice Areas']
            : (record.fields['Practice Areas'] ? [record.fields['Practice Areas']] : []),
          bio: record.fields['Bio'] || '',
          education: record.fields['Education'] || '',
          barAdmissions: record.fields['Bar Admissions'] || '',
          headshot: getInstructorHeadshot(record),
          facultyId: instructorName.toLowerCase()
            .replace(/[^a-z0-9\s]/g, '')
            .replace(/\s+/g, '-')
            .replace(/^-+|-+$/g, '')
        };

        // Add instructor to each of their practice areas
        if (instructor.practiceAreas && instructor.practiceAreas.length > 0) {
          instructor.practiceAreas.forEach(practiceArea => {
            if (!instructorsByPractice[practiceArea]) {
              instructorsByPractice[practiceArea] = [];
            }
            instructorsByPractice[practiceArea].push(instructor);
          });
        } else {
          // Default to Employment Law if no practice areas specified
          if (!instructorsByPractice['Employment Law']) {
            instructorsByPractice['Employment Law'] = [];
          }
          instructorsByPractice['Employment Law'].push(instructor);
        }
      });

      // Create faculty cards for each practice area
      Object.entries(instructorsByPractice).forEach(([practiceArea, instructors]) => {
        const sectionId = practiceAreaMap[practiceArea];
        if (!sectionId) return;

        const section = document.getElementById(sectionId);
        if (!section) return;

        let facultyGrid = section.querySelector('.faculty-grid');
        if (!facultyGrid) {
          facultyGrid = document.createElement('div');
          facultyGrid.className = 'faculty-grid';
          section.appendChild(facultyGrid);
        }

        // Sort instructors alphabetically by last name
        const sortedInstructors = instructors.sort((a, b) => {
          const lastNameA = (a.lastName || '').toLowerCase().trim();
          const lastNameB = (b.lastName || '').toLowerCase().trim();

          if (lastNameA && lastNameB) {
            return lastNameA.localeCompare(lastNameB);
          }

          const getLastName = (fullName) => {
            const nameParts = fullName.toLowerCase().trim().split(/\s+/);
            return nameParts[nameParts.length - 1];
          };

          const fallbackLastNameA = getLastName(a.name);
          const fallbackLastNameB = getLastName(b.name);
          return fallbackLastNameA.localeCompare(fallbackLastNameB);
        });

        // Create cards for each instructor
        sortedInstructors.forEach(instructor => {
          const facultyCard = createFacultyCard(instructor);
          facultyGrid.appendChild(facultyCard);
        });
      });
    }

    // ============================================================================
    // AIRTABLE DATA FETCHING
    // ============================================================================

    /**
     * Fetch records from Airtable via the server-side proxy
     */
    async function fetchAllAirtableRecords(tableId, filterFormula = null) {
      const params = new URLSearchParams();
      params.set('table', tableId);
      if (filterFormula) params.set('filterByFormula', filterFormula);

      const response = await fetch(`/api/airtable-programs?${params.toString()}`);
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error || `Proxy error: ${response.status}`);
      }
      const data = await response.json();
      return data.records || [];
    }

    /**
     * Load instructor data from Airtable
     */
    async function loadInstructorData() {
      try {
        const records = await fetchAllAirtableRecords(AIRTABLE_CONFIG.instructorsTableId);
        populateFacultyCards(records);

        // Handle deep linking after cards are populated
        handleDeepLink();

      } catch (error) {
        console.error('Error loading instructor data:', error);

        // Show error message in faculty grids
        document.querySelectorAll('.faculty-grid').forEach(grid => {
          grid.innerHTML = '<p class="loading-skeleton">Unable to load faculty data. Please refresh the page.</p>';
        });
      }
    }

    /**
     * Handle deep linking to specific faculty members
     */
    function handleDeepLink() {
      const hash = window.location.hash;
      if (hash && hash.length > 1) {
        const facultyId = hash.substring(1);
        const facultyCard = document.querySelector(`[data-faculty-id="${facultyId}"]`);

        if (facultyCard) {
          // Scroll to the card
          setTimeout(() => {
            facultyCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

            // Add highlight effect
            facultyCard.classList.add('highlighted');

            // Remove highlight after animation
            setTimeout(() => {
              facultyCard.classList.remove('highlighted');
            }, 6000);
          }, 500);
        }
      }
    }

    // ============================================================================
    // TESTIMONIALS
    // ============================================================================

    // Store instructor record IDs mapped to faculty IDs for testimonial matching
    let instructorRecordMap = {};

    /**
     * Load testimonials from Airtable and populate them on faculty cards
     */
    async function loadTestimonials() {
      try {
        const records = await fetchAllAirtableRecords(AIRTABLE_CONFIG.testimonialsTableId);
        populateTestimonials(records);
      } catch (error) {
        console.error('Error loading testimonials:', error);
      }
    }

    /**
     * Populate testimonials on faculty cards
     */
    function populateTestimonials(testimonialRecords) {
      // Group testimonials by instructor record ID
      const testimonialsByInstructor = {};

      testimonialRecords.forEach(record => {
        const instructorIds = record.fields['Instructors'] || [];
        const quoteText = record.fields['Quote Text'] || '';
        const participantName = record.fields['Participant Name'] || '';
        const participantTitle = record.fields['Participant Title'] || '';
        const participantCompany = record.fields['Participant Company'] || '';

        // Skip if no quote text
        if (!quoteText.trim()) return;

        // Add testimonial to each linked instructor
        instructorIds.forEach(instructorId => {
          if (!testimonialsByInstructor[instructorId]) {
            testimonialsByInstructor[instructorId] = [];
          }
          testimonialsByInstructor[instructorId].push({
            quote: quoteText,
            name: participantName,
            title: participantTitle,
            company: participantCompany
          });
        });
      });

      // Populate testimonials on each faculty card (one random testimonial per instructor)
      Object.entries(instructorRecordMap).forEach(([recordId, facultyId]) => {
        const testimonials = testimonialsByInstructor[recordId];
        if (!testimonials || testimonials.length === 0) return;

        const testimonialSection = document.getElementById(`testimonials-${facultyId}`);
        if (!testimonialSection) return;

        // Pick one random testimonial
        const randomIndex = Math.floor(Math.random() * testimonials.length);
        const t = testimonials[randomIndex];

        // Build single testimonial card HTML
        const testimonialCardHtml = `
          <div class="testimonial-card">
            <p class="testimonial-text">"${escapeHtml(t.quote)}"</p>
            <div class="testimonial-attribution">
              <div class="testimonial-author">${escapeHtml(t.name)}</div>
              ${t.title ? `<div class="testimonial-role">${escapeHtml(t.title)}</div>` : ''}
              ${t.company ? `<div class="testimonial-company">${escapeHtml(t.company)}</div>` : ''}
            </div>
            <div class="testimonial-stars"><img src="https://storage.googleapis.com/msgsndr/MjGEy0pobNT9su2YJqFI/media/68d667936fe1a53fe6603670.png" alt="5 stars" class="stars-img"></div>
          </div>
        `;

        testimonialSection.innerHTML = testimonialCardHtml;
        testimonialSection.style.display = 'block';
      });
    }

    /**
     * Modified instructor loading to store record ID mapping
     */
    async function loadInstructorDataWithMapping() {
      try {
        const records = await fetchAllAirtableRecords(AIRTABLE_CONFIG.instructorsTableId);

        // Build mapping of Airtable record IDs to faculty IDs
        records.forEach(record => {
          let instructorName = record.fields['Name'] || '';

          // Handle case where name is in title field
          if (!instructorName && record.fields['Title']) {
            let titleField = record.fields['Title'];
            let separators = [' – ', ' - ', ' — ', ' | ', '  '];
            for (let separator of separators) {
              if (titleField.includes(separator)) {
                instructorName = titleField.split(separator)[0].trim();
                break;
              }
            }
            if (!instructorName) instructorName = titleField;
          }

          const facultyId = instructorName.toLowerCase()
            .replace(/[^a-z0-9\s]/g, '')
            .replace(/\s+/g, '-')
            .replace(/^-+|-+$/g, '');

          instructorRecordMap[record.id] = facultyId;
        });

        populateFacultyCards(records);
        handleDeepLink();

        // Load testimonials after faculty cards are populated
        await loadTestimonials();

      } catch (error) {
        console.error('Error loading instructor data:', error);
        document.querySelectorAll('.faculty-grid').forEach(grid => {
          grid.innerHTML = '<p class="loading-skeleton">Unable to load faculty data. Please refresh the page.</p>';
        });
      }
    }

    // ============================================================================
    // INITIALIZATION
    // ============================================================================

    document.addEventListener('DOMContentLoaded', () => {
      loadInstructorDataWithMapping();
    });

    // Handle hash changes for deep linking
    window.addEventListener('hashchange', handleDeepLink);
  </script>

</body>
</html>
